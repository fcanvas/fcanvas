import{_ as s,o as a,c as n,b as e}from"./app.3f0c40d3.js";const u=JSON.parse('{"title":"Optimizing canvas","description":"","frontmatter":{},"headers":[],"relativePath":"guide/extra-topics/performance.md","lastUpdated":1678175173000}'),o={name:"guide/extra-topics/performance.md"},l=e(`<h1 id="optimizing-canvas" tabindex="-1">Optimizing canvas <a class="header-anchor" href="#optimizing-canvas" aria-hidden="true">#</a></h1><p>The <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/canvas" target="_blank" rel="noreferrer"><code>&lt;canvas&gt;</code></a> element is one of the most widely used tools for rendering 2D graphics on the web. However, when websites and apps push the Canvas API to its limits, performance begins to suffer. This article provides suggestions for optimizing your use of the canvas element to ensure that your graphics perform well.</p><div class="tip custom-block"><p class="custom-block-title">TIP</p><p><code>fcanvas</code> has done it all for you to improve performance, but you can still improve it further with the following performance tips</p></div><p>The following is a collection of tips to improve canvas performance.</p><h3 id="avoid-floating-point-coordinates-and-use-integers-instead" tabindex="-1"><a href="#avoid_floating-point_coordinates_and_use_integers_instead">Avoid floating-point coordinates and use integers instead</a> <a class="header-anchor" href="#avoid-floating-point-coordinates-and-use-integers-instead" aria-hidden="true">#</a></h3><p>Sub-pixel rendering occurs when you render objects on a canvas without whole values.</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> circle </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Circle</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">x</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.3</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">y</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">0.5</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">radius</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15.9</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>This forces the browser to do extra calculations to create the anti-aliasing effect. To avoid this, make sure to round all co-ordinates used in calls to <a href="https://developer.mozilla.org/en-US/docs/Web/API/CanvasRenderingContext2D/drawImage" title="drawImage()" target="_blank" rel="noreferrer"><code>drawImage()</code></a> using <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Math/floor" target="_blank" rel="noreferrer"><code>Math.floor()</code></a>, for example.</p><h3 id="don-t-scale-images-in-drawimage" tabindex="-1"><a href="#dont_scale_images_in_drawimage">Don&#39;t scale images in <code>drawImage</code></a> <a class="header-anchor" href="#don-t-scale-images-in-drawimage" aria-hidden="true">#</a></h3><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>Since version 0.3 you don&#39;t have to worry about this <code>fcanvas</code> does it automatically</p></div><p>Cache various sizes of your images on an offscreen canvas when loading as opposed to constantly scaling them in <code>crop</code> <a href="/guide/shapes/Image">Image</a>, <a href="/guide/shapes/ImageRepeat">ImageRepeat</a>, <a href="/guide/shapes/Sprite">Sprite</a></p><h3 id="use-multiple-layered-canvases-for-complex-scenes" tabindex="-1"><a href="#use_multiple_layered_canvases_for_complex_scenes">Use multiple layered canvases for complex scenes</a> <a class="header-anchor" href="#use-multiple-layered-canvases-for-complex-scenes" aria-hidden="true">#</a></h3><p>In your application, you may find that some objects need to move or change frequently, while others remain relatively static. A possible optimization in this situation is to layer your items using multiple <code>Layer</code> elements.</p><p>For example, let&#39;s say you have a game with a UI on top, the gameplay action in the middle, and a static background on the bottom. In this case, you could split your game into three <code>Layer</code> layers. The UI would change only upon user input, the gameplay layer would change with every new frame, and the background would remain generally unchanged.</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> layerMain </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Layer</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> layerBackground </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">Layer</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="use-plain-css-for-large-background-images" tabindex="-1"><a href="#use_plain_css_for_large_background_images">Use plain CSS for large background images</a> <a class="header-anchor" href="#use-plain-css-for-large-background-images" aria-hidden="true">#</a></h3><p>If you have a static background image, you can draw it onto a plain <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/Element/div" target="_blank" rel="noreferrer"><code>&lt;div&gt;</code></a> element using the CSS <a href="https://developer.mozilla.org/en-US/docs/Web/CSS/background" target="_blank" rel="noreferrer"><code>background</code></a> property and position it under the canvas. This will negate the need to render the background to the canvas on every tick.</p><h3 id="scaling-canvas-using-css-transforms" tabindex="-1"><a href="#scaling_canvas_using_css_transforms">Scaling canvas using CSS transforms</a> <a class="header-anchor" href="#scaling-canvas-using-css-transforms" aria-hidden="true">#</a></h3><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You don&#39;t need to worry about this with the new algorithm applied from version 0.3 this becomes meaningless</p></div><p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_Transforms/Using_CSS_transforms" target="_blank" rel="noreferrer">CSS transforms</a> are faster since they use the GPU. The best case is to not scale the canvas, or have a smaller canvas and scale up rather than a bigger canvas and scale down.</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> scaleX </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">innerWidth </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> canvas</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">width</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> scaleY </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">innerHeight </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;"> canvas</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">height</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> scaleToFit </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">min</span><span style="color:#A6ACCD;">(scaleX</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> scaleY)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> scaleToCover </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> Math</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">max</span><span style="color:#A6ACCD;">(scaleX</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> scaleY)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">stage[DIV_ELEMENT]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">style</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">transformOrigin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">0 0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">//scale from top left</span></span>
<span class="line"><span style="color:#A6ACCD;">stage[DIV_ELEMENT]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">style</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">transform </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">scale(</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">scaleToFit</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">)</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h3 id="turn-off-transparency" tabindex="-1"><a href="#turn_off_transparency">Turn off transparency</a> <a class="header-anchor" href="#turn-off-transparency" aria-hidden="true">#</a></h3><div class="tip custom-block"><p class="custom-block-title">TIP</p><p>You don&#39;t need to worry about this with the new algorithm applied from version 0.3 this becomes meaningless</p></div><p>If your application uses canvas and doesn&#39;t need a transparent backdrop, set the <code>alpha</code> option to <code>false</code> when creating a drawing context with <a href="https://developer.mozilla.org/en-US/docs/Web/API/HTMLCanvasElement/getContext" target="_blank" rel="noreferrer"><code>HTMLCanvasElement.getContext()</code></a>. This information can be used internally by the browser to optimize rendering.</p><h3 id="scaling-for-high-resolution-displays" tabindex="-1"><a href="#scaling_for_high_resolution_displays">Scaling for high resolution displays</a> <a class="header-anchor" href="#scaling-for-high-resolution-displays" aria-hidden="true">#</a></h3><p>You may find that canvas items appear blurry on higher-resolution displays. While many solutions may exist, a simple first step is to scale the canvas size up and down simultaneously, using its attributes, styling, and its context&#39;s scale.</p><div class="language-ts line-numbers-mode"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki material-theme-palenight" tabindex="0"><code><span class="line"><span style="color:#676E95;font-style:italic;">// Get the DPR and size of the canvas</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> dpr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> window</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">devicePixelRatio</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> rect </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> canvas</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getBoundingClientRect</span><span style="color:#A6ACCD;">()</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Set the &quot;actual&quot; size of the canvas</span></span>
<span class="line"><span style="color:#A6ACCD;">canvas</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">width </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> rect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">width </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> dpr</span></span>
<span class="line"><span style="color:#A6ACCD;">canvas</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">height </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> rect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">height </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;"> dpr</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Scale the context to ensure correct drawing operations</span></span>
<span class="line"><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">scale</span><span style="color:#A6ACCD;">(dpr</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> dpr)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// Set the &quot;drawn&quot; size of the canvas</span></span>
<span class="line"><span style="color:#A6ACCD;">canvas</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">style</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">width </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`\${</span><span style="color:#A6ACCD;">rect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">width</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">px</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#A6ACCD;">canvas</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">style</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">height </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`\${</span><span style="color:#A6ACCD;">rect</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">height</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">px</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"></span></code></pre><div class="line-numbers-wrapper" aria-hidden="true"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h3 id="using-group" tabindex="-1"><a href="#using_group">Using Group</a> <a class="header-anchor" href="#using-group" aria-hidden="true">#</a></h3><p>If you have a lot of elements that don&#39;t change often you can use <a href="/guide/essentials/Group">Group</a> to group them together</p><p>Reference: <a href="/guide/essentials/Group">Usage Group</a></p><h3 id="using-webworker" tabindex="-1"><a href="#using_webworker">Using WebWorker</a> <a class="header-anchor" href="#using-webworker" aria-hidden="true">#</a></h3><p>It&#39;s a bit odd that WebWorker is here because in general using WebWorker doesn&#39;t bring any performance improvement it just keeps your application from getting blocked by heavy tasks.</p><p>Reference: <a href="/guide/plugins/worker">Usage @fcanvas/worker</a></p>`,33),p=[l];function r(t,c,i,d,y,h){return a(),n("div",null,p)}const C=s(o,[["render",r]]);export{u as __pageData,C as default};
